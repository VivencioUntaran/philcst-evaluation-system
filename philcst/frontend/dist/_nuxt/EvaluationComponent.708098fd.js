import{_ as X}from"./DepartmentSelector.04ab34fc.js";import{u as Q}from"./useAPI.05844c13.js";import{_ as U,v as P,q as M,o as s,c as i,a as e,t as v,F as g,D as T,B as V,x as o,H as z,p as G,f as H,r as Z,d as R,z as N,A as J,C as K,E as C,G as ee,L as W,b as te,s as ae}from"./entry.b4168997.js";const ne={class:"question-item__selection-container d-flex justify-content-end"},oe=["onClick"],se={__name:"QuestionItem",props:{question:{type:Object,default:()=>{}},entryId:{type:Number,default:0},criteriaId:{type:Number,default:0}},setup(l){const d=l,y=Q(),_=P({activeClass:"question-item__option--active",selectedAnswer:null,answered:!1,encryptedClass:"M7WEby4uyF"});async function t(p){const h=`.question-${d.question.id}-${p.id}`;F(),w(h),await n(p)}async function n(p){var f;if(((f=_.selectedAnswer)==null?void 0:f.id)===p.id)return!1;_.selectedAnswer=p,_.answered=!0;const h={evaluation_entry_id:d.entryId,criteria_id:d.criteriaId,question_id:d.question.id,choice_id:p.id};await y({url:"evaluation-answers/create",method:"POST",headers:{"Content-Type":"application/json"},data:h})}function w(p){document.querySelector(p).classList.add(_.activeClass)}function F(){const p=`.question-${d.question.id}`,h=document.querySelectorAll(p);h.length&&h.forEach(f=>{f.classList.remove(_.activeClass)})}function S(p){return p.evaluation_answer!==null?_.activeClass:""}function Y(){d.question.choices.find(h=>h.evaluation_answer!==null)&&(_.answered=!0)}return M(()=>{Y()}),(p,h)=>(s(),i("div",{class:V([["question-item",!o(_).answered&&o(_).encryptedClass],"letter-spacing fw-medium"])},[e("span",null,v(l.question.question),1),e("div",ne,[(s(!0),i(g,null,T(d.question.choices,(f,q)=>(s(),i("div",{key:q,onClick:I=>t(f),class:"question-item__option-wrapper mx-2"},[e("div",{class:V(["question-item__option",`question-${l.question.id}`,`question-${l.question.id}-${f.id}`,S(f)])},null,2)],8,oe))),128))])],2))}},ie=U(se,[["__scopeId","data-v-9c32f381"]]);const le=l=>(G("data-v-13252f18"),l=l(),H(),l),ce={class:"criteria-component"},re={class:"criteria-component__header stack-container mb-3"},ue={class:"criteria-component__points d-flex justify-content-end"},de=le(()=>e("span",{class:"fw-medium"}," Points: ",-1)),_e={class:"criteria-component__point-wrapper d-flex"},pe={class:"point"},ve={class:"criteria-component__question-container"},me={__name:"CriteriaComponent",props:{criteria:{type:Object,default:()=>{}},entryId:{type:Number,default:0}},setup(l){const d=l;return(y,_)=>{const t=ie;return s(),i("div",ce,[e("div",re,[e("h2",null,v(d.criteria.name),1)]),e("div",ue,[de,e("div",_e,[(s(!0),i(g,null,T(d.criteria.criteria_points,(n,w)=>(s(),i("div",{key:w,class:"criteria-component__point-item mx-2"},[e("span",pe,v(n.label),1)]))),128))])]),e("div",ve,[(s(!0),i(g,null,T(l.criteria.questions,(n,w)=>(s(),z(t,{key:w,question:n,entryId:l.entryId,criteriaId:d.criteria.id},null,8,["question","entryId","criteriaId"]))),128))])])}}},ye=U(me,[["__scopeId","data-v-13252f18"]]);const D=l=>(G("data-v-399cfc9d"),l=l(),H(),l),he={class:"evaluation-form"},fe={key:0,class:"evaluation-form__body"},we={class:"evaluation-form__evaluatee stack-container"},be={class:"letter-spacing"},qe={class:"letter-spacing"},Ee=D(()=>e("b",null,"Department: ",-1)),$e={class:"letter-spacing"},ke=D(()=>e("b",null,"Academic Year: ",-1)),Ce={class:"evaluation-form__caption m-4"},ge=["innerHTML"],Te={key:0},xe={class:"evaluation-form__criteria-wrapper"},Se={class:"evaluation-form__comment-wrapper"},Ie={class:"d-flex flex-column fw-medium"},Pe=D(()=>e("label",{for:"comment",class:"m-2"}," Comment (Optional) ",-1)),De={key:0,class:"d-flex flex-column"},Fe={for:"comment"},Ye=D(()=>e("option",{value:"",selected:""}," No point ",-1)),je=["value"],Ae={class:"d-flex justify-content-end"},Ve={key:1},Ne=D(()=>e("p",null," No criteria questions. ",-1)),Ue=[Ne],Oe={key:1,class:"spinner-border text-primary",role:"status"},Be=D(()=>e("span",{class:"visually-hidden"},"Loading...",-1)),Le=[Be],Re={__name:"EvaluationForm",props:{evaluationData:{type:Object,default:()=>{}},questionnaireType:{type:String,default:""}},emits:["backToEvaluation"],setup(l,{emit:d}){const y=l,_=Q(),t=P({loaded:!1,entryPayload:{},evaluationEntry:{},academicYear:{},caption:"<p><b>Directions:</b> Check the corresponding points earned by the faculty member for each criteria.</p>",questionnaire:{},comments:"",enabledSubmit:!0,pointsSelection:[1,2,3,4,5,6,7,8,9,10],evaluationPoints:"",requiredPoint:!1});M(async()=>{await n(),t.loaded=!0});async function n(){await w(),await F(),await Y(),await S()}async function w(){t.academicYear=y.evaluationData.activeYear;const u=y.evaluationData.questionnaires.find(a=>a.slug===y.questionnaireType);u&&(t.questionnaire=u)}async function F(){const u=t.academicYear.id,a=t.questionnaire.id,c=P({evaluator_id:y.evaluationData.evaluator.id,evaluatee_id:y.evaluationData.evaluatee.id,academic_year_id:u,questionnaire_id:a});t.entryPayload=c}async function S(){y.questionnaireType==="peer-to-peer"&&(t.requiredPoint=!0)}async function Y(){const a=(await _({url:"/evaluation-entries/entry-checker",method:"POST",headers:{"Content-Type":"application/json"},data:t.entryPayload})).data.record;if(!a)await p();else{if(a.isDone){alert("You're done evaluating this faculty. Select another faculty."),j();return}await h(a)}}async function p(){const u=await _({url:"/evaluation-entries/create",method:"POST",headers:{"Content-Type":"application/json"},data:t.entryPayload});await h(u.data.record)}async function h(u){const a={entry_id:u.id,questionnaire:y.questionnaireType},c=await _({url:"evaluation-entries/single-entry",method:"POST",headers:{"Content-Type":"application/json"},data:a});return t.evaluationEntry=c.data.record,t.academicYear=c.data.academic_year,t.comments=c.data.record.comments,c.data.record}async function f(){const u={entry_id:t.evaluationEntry.id,comments:t.comments,points:t.evaluationPoints?t.evaluationPoints:0};await _({url:"/evaluation/update-coment",method:"POST",headers:{"Content-Type":"application/json"},data:u}),t.enabledSubmit=!0}const q=Z(0);function I(){t.enabledSubmit=!1,clearTimeout(q.value),q.value=setTimeout(()=>{f()},2e3)}async function E(){if(!await B())return alert("Please answer all questions highlighted in red."),!1;if(!await L())return alert("Please select a point."),!1;await O()}async function O(){const u={entry_id:t.evaluationEntry.id};await _({url:"/evaluation/update-status",method:"POST",headers:{"Content-Type":"application/json"},data:u}),alert("You have successfully evaluated this faculty. You will now be redirected to evaluation page."),j()}async function B(){const u=t.evaluationEntry;await h(u);const a=document.querySelectorAll(".M7WEby4uyF");return a!=null&&a.length?(a.forEach(c=>{c.classList.add("question-item--error")}),!1):!0}async function L(){return t.requiredPoint&&t.comments?!!t.evaluationPoints:!0}function j(){d("backToEvaluation")}return(u,a)=>{var m,$,r,k;const c=ye;return s(),i("div",he,[o(t).loaded?(s(),i("div",fe,[e("div",we,[e("div",be,[e("b",null,v(l.evaluationData.evaluatee.role.role.toUpperCase())+": ",1),R(),e("span",null,v(l.evaluationData.evaluatee.name),1)]),e("div",qe,[Ee,R(),e("span",null,v(l.evaluationData.evaluatee.department.department),1)]),e("div",$e,[ke,R(),e("span",null,v(o(t).academicYear.year)+" "+v(o(t).academicYear.semester)+" semester ",1)])]),e("div",Ce,[e("div",{innerHTML:o(t).caption,class:"letter-spacing"},null,8,ge)]),(k=(r=($=(m=o(t))==null?void 0:m.evaluationEntry)==null?void 0:$.questionnaire)==null?void 0:r.criterias)!=null&&k.length?(s(),i("div",Te,[e("div",xe,[(s(!0),i(g,null,T(o(t).evaluationEntry.questionnaire.criterias,(b,A)=>(s(),z(c,{key:A,criteria:b,entryId:o(t).evaluationEntry.id},null,8,["criteria","entryId"]))),128))]),e("div",Se,[e("div",Ie,[Pe,N(e("textarea",{name:"comment",cols:"30",rows:"10","onUpdate:modelValue":a[0]||(a[0]=b=>o(t).comments=b),onInput:I},`\r
            `,544),[[J,o(t).comments]])]),y.questionnaireType==="peer-to-peer"&&o(t).comments?(s(),i("div",De,[e("label",Fe," Points "+v(o(t).requiredPoint?"*":"(optional)"),1),N(e("select",{class:"evaluation-form__point-select","onUpdate:modelValue":a[1]||(a[1]=b=>o(t).evaluationPoints=b),onChange:f},[Ye,(s(!0),i(g,null,T(o(t).pointsSelection,(b,A)=>(s(),i("option",{key:A,value:b},v(b),9,je))),128))],544),[[K,o(t).evaluationPoints]])])):C("",!0)]),e("div",Ae,[e("button",{type:"button",class:V(["evaluation-form__submit",!o(t).enabledSubmit&&"evaluation-form__submit--disabled"]),onClick:E},v(o(t).enabledSubmit?"Submit":"Please wait..."),3)])])):(s(),i("div",Ve,Ue))])):(s(),i("div",Oe,Le))])}}},Qe=U(Re,[["__scopeId","data-v-399cfc9d"]]);const x=l=>(G("data-v-9a93f32a"),l=l(),H(),l),Me={class:"evaluation-component bgCard"},ze={key:0},Ge={key:0,class:"evaluation-component__header"},He={key:0,class:"stack-container"},We={class:"d-flex justify-content-between"},Je={key:0,class:"d-flex justify-content-between"},Ke={class:"w-100 px-2"},Xe=x(()=>e("label",{for:""}," Select role ",-1)),Ze=x(()=>e("option",{value:"",selected:""}," All Roles ",-1)),et=["value"],tt={class:"w-100 px-2"},at=x(()=>e("label",null,"Search",-1)),nt={class:"d-flex align-items-center justify-content-between"},ot=["placeholder"],st={key:1},it=x(()=>e("p",null," You've already evaluated a peer. ",-1)),lt=[it],ct={key:1,class:"evaluation-component__body"},rt={key:0,class:"table-container"},ut={key:0,class:"table table-bordered table-striped position-relative"},dt=x(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Name "),e("th",{scope:"col"},"Department"),e("th",{scope:"col"},"Role"),e("th",{scope:"col"}," Status "),e("th",{scope:"col"},"Action")])],-1)),_t={scope:"row"},pt=["onClick"],vt={key:1},mt=x(()=>e("p",null," No record found. ",-1)),yt=[mt],ht={key:1,class:"spinner-border text-primary",role:"status"},ft=x(()=>e("span",{class:"visually-hidden"},"Loading...",-1)),wt=[ft],bt={__name:"EvaluationComponent",props:{questionnaireType:{type:String,default:""}},setup(l){const d=l,y=Q(),{getCurrentUser:_}=ee();let t=P({});const n=P({evaluatees:[],loaded:!1,departmentId:"",roles:[{label:"Faculty",value:"faculty"},{label:"Dean",value:"dean"}],selectedRole:"",isEvaluating:!1,searchQuery:"",evaluatedFaculties:[],peerEvaluatedFaculties:[]}),w=W(()=>!!(t&&t.role.role==="admin"));async function F(){t=_()}async function S(){const a=t;console.log(n);const c={role:a.role.role,department_id:n.departmentId,evaluatee_name:n.searchQuery,evaluatee_role:n.selectedRole,evaluator_id:a.id,questionnaire_type:d.questionnaireType},m=await y({url:"evaluation/fetch-faculties",method:"POST",headers:{"Content-Type":"application/json"},data:c});n.evaluatedFaculties=m.data.evaluated_faculties,n.peerEvaluatedFaculties=m.data.peer_evaluated_faculties;const $=p(m.data.records);n.evaluatees=$}function Y(){t.role.role!=="admin"?n.departmentId=t.department_id:n.departmentId=""}function p(a){if(d.questionnaireType!=="peer-to-peer")return a;{const c=[];return a.forEach(m=>{var r;((r=n.peerEvaluatedFaculties)==null?void 0:r.find(k=>k.evaluatee_id===m.id))||c.push(m)}),c}}async function h(){const a=ae(),m=`/${t.role.role}`;E.activeYear?E.activeYear.status==="closed"&&(alert("Status is closed. You are not allowed to evaluate yet."),a.push(m)):(alert("No active year"),a.push(m))}async function f(){await F(),await B(),await h(),await Y(),await S(),await O()}async function q(){n.loaded=!1,await S(),n.loaded=!0}function I(a){const m=!!n.evaluatedFaculties.find($=>$.evaluatee_id===a.id);return{...a,evaluated:m}}const E=P({evaluatee:{},evaluator:t,activeYear:null,questionnaires:[]});async function O(){const a=await y({url:"/evaluation/fetch-questionnaires",method:"GET",headers:{"Content-Type":"application/json"}});E.questionnaires=a.data.records}async function B(){const a=await y({url:"/evaluation/fetch-active-year",method:"GET",headers:{"Content-Type":"application/json"}});E.activeYear=a.data.record}function L(a){E.evaluatee=a,E.evaluator=t,n.isEvaluating=!0}const j=W(()=>d.questionnaireType==="peer-to-peer"?!n.evaluatedFaculties.length:!0);async function u(){n.isEvaluating=!1,await q()}return M(async()=>{await f(),n.loaded=!0}),(a,c)=>{const m=X,$=Qe;return s(),i("div",Me,[o(n).loaded?(s(),i("div",ze,[o(n).isEvaluating?C("",!0):(s(),i("div",Ge,[o(j)?(s(),i("div",He,[e("div",We,[te(m,{modelValue:o(n).departmentId,"onUpdate:modelValue":c[0]||(c[0]=r=>o(n).departmentId=r),onValueChanged:q,disabled:!o(w)},null,8,["modelValue","disabled"])]),o(w)?(s(),i("div",Je,[e("div",Ke,[Xe,N(e("select",{name:"role","onUpdate:modelValue":c[1]||(c[1]=r=>o(n).selectedRole=r),onChange:q,class:"w-100 mx-0"},[Ze,(s(!0),i(g,null,T(o(n).roles,(r,k)=>(s(),i("option",{key:k,value:r.value},v(r.label),9,et))),128))],544),[[K,o(n).selectedRole]])]),e("div",tt,[at,e("div",nt,[N(e("input",{type:"text",name:"seachQuery","onUpdate:modelValue":c[2]||(c[2]=r=>o(n).searchQuery=r),placeholder:o(w)?"Search instructor or dean":"Search instructor",class:"mx-0 w-100"},null,8,ot),[[J,o(n).searchQuery]]),e("button",{onClick:q,class:"cstm-button mx-2 px-4"}," Search ")])])])):C("",!0)])):C("",!0),d.questionnaireType==="peer-to-peer"&&o(n).evaluatedFaculties.length?(s(),i("div",st,lt)):C("",!0)])),o(n).isEvaluating?C("",!0):(s(),i("div",ct,[o(j)?(s(),i("div",rt,[o(n).evaluatees.length?(s(),i("table",ut,[dt,e("tbody",null,[(s(!0),i(g,null,T(o(n).evaluatees,(r,k)=>{var b;return s(),i("tr",{key:k},[e("th",_t,v(k+1),1),e("td",null,v(r.name),1),e("td",null,v((b=r.department)==null?void 0:b.department),1),e("td",null,v(r.role.role.toUpperCase()),1),e("td",null,v(I(r).evaluated?"Evaluated":"Not yet evaluated"),1),e("td",null,[e("button",{class:V(["cstm-button m-1","tdButton",I(r).evaluated&&"button-evaluated no-click"]),onClick:A=>L(r)},v(I(r).evaluated?"Evaluated":"Evaluate"),11,pt)])])}),128))])])):(s(),i("div",vt,yt))])):C("",!0)])),o(n).isEvaluating?(s(),z($,{key:2,evaluationData:o(E),questionnaireType:l.questionnaireType,onBackToEvaluation:u},null,8,["evaluationData","questionnaireType"])):C("",!0)])):(s(),i("div",ht,wt))])}}},kt=U(bt,[["__scopeId","data-v-9a93f32a"]]);export{kt as _};
