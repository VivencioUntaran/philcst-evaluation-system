import{_ as $}from"./DepartmentSelector.04ab34fc.js";import{_ as j}from"./LoaderComponent.f87782ea.js";import{u as L}from"./useAPI.05844c13.js";import{_ as R,G as O,r as I,v as N,q as z,o as d,c as l,x as u,a as p,y as G,F as H,D as J,t as h,z as K,N as Q,E as m,B as y,b as W,H as X,s as Y,p as Z,f as ee}from"./entry.b4168997.js";const ae=i=>(Z("data-v-55a9c115"),i=i(),ee(),i),te={key:0,class:"transition w-100"},se={class:"bgCard-none"},re=["onSubmit"],oe=["type","onUpdate:modelValue","placeholder","required","disabled"],ne={key:1},de={key:0,class:y(["user-information-form__selector-container"])},le=ae(()=>p("div",{class:"user-information-form__submit-container"},[p("button",{type:"submit",class:"w-100"}," Submit ")],-1)),b="dvCcRVqCRP",ie={__name:"UserInformationForm",props:{formType:{type:String,default:"create"},role:{type:String,default:""},customClass:{type:String,default:""},backLink:{type:String,default:"/"},disabledSelector:{type:Boolean,default:!1}},setup(i){const r=i,w=L(),{getCurrentUser:v,saveAuthDetails:q}=O(),g=I(!1);let e=N({fullName:"",lastName:"",email:"",departmentId:"",password:"",confirmPassword:"",role_id:"",studentNumber:""});const f=I(!1),S=N([{type:"text",label:"Full Name",required:!0,vModel:"fullName",name:"full_name",placeholder:"Enter full name",disabled:!1},{type:"email",label:"Email",required:!0,vModel:"email",name:"email",placeholder:"Enter email",disabled:!1},{type:"password",label:"Password",required:r.formType==="create",vModel:"password",name:"password",placeholder:"Enter password",disabled:!1},{type:"password",label:"Confirm Password",required:r.formType==="create",vModel:"confirmPassword",name:"confirm_password",placeholder:"Confirm password",disabled:!1}]),C={vModel:"departmentId",name:"department_id"},P={type:"text",label:"Student Number",required:!0,vModel:"studentNumber",name:"student_number",placeholder:"Enter student number",disabled:r.formType==="update"};z(async()=>{await V(),await T(),await M(),await x(),g.value=!0});async function T(){r.role==="student"&&S.unshift(P)}async function x(){const t=v();e.departmentId=t!=null&&t.department_id?t.department_id:""}async function M(){r.formType==="update"&&await D()}async function D(){const t=v();e={...e,departmentId:t.department_id,fullName:t.name,studentNumber:t.student_number,email:t.email,user_id:t.id},console.log(e,t)}async function V(){const t={role:r.role},o=(await w({url:"/user_auth/filter_role",method:"POST",headers:{"Content-Type":"application/json"},data:t})).data.record;e.role_id=o.id}function _(t){var n;const s={show:!1,message:""},o=t.name.replace(/(^\w)/g,a=>a[0].toUpperCase()).replace(/([-_]\w)/g,a=>" "+a[1].toUpperCase()).trim();switch(t.name){case"confirm_password":!e.confirmPassword.length&&e.password.length?(s.show=!0,s.message=`${o} is required`):e.password.length&&e.confirmPassword.length&&e.password!==e.confirmPassword&&(s.show=!0,s.message="Passwords do not match");break;case"department_id":s.message=`The ${o} field is required`,!e[t.vModel]&&f.value?s.show=!0:s.show=!1;break;default:s.message=`The ${o} field is required`,!((n=e[t.vModel])==null?void 0:n.length)&&f.value?s.show=!0:s.show=!1;break}return s}async function E(){f.value=!0,setTimeout(async()=>{await U()&&(r.formType==="create"?F():A())},200)}async function U(){return!document.querySelectorAll(`.${b}`).length}async function F(){var o,n;const t=e.departmentId,s={...e,role:r.role,name:e.fullName,password_confirmation:e.confirmPassword,department_id:e.departmentId,readable_role:r.role,student_number:e.studentNumber};r.disabledSelector&&(s.department_id=t);try{const a=await w({url:"/user_auth/register",method:"POST",headers:{"Content-Type":"application/json"},data:s});alert("Data has been saved"),r.backLink.length&&Y().push(r.backLink),k()}catch(a){const c=(n=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:n.message;c&&alert(c)}}async function A(){var s,o;const t={...e,name:e.fullName,password_confirmation:e.confirmPassword};console.log(e);try{const n=await w({url:"/user_auth/update_user",method:"PATCh",headers:{"Content-Type":"application/json"},data:t});alert("Data has been updated"),q({data:{user:n.data.record}}),k()}catch(n){const a=(o=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:o.message;a&&alert(a)}}function k(){r.formType==="create"?(e.fullName="",e.email="",e.departmentId="",e.password="",e.confirmPassword="",e.role_id="",e.studentNumber=""):(e.password="",e.confirmPassword=""),f.value=!1}return(t,s)=>{const o=$,n=j;return d(),l("div",{class:y(["user-information-form",`user-information-form--${i.customClass}`])},[u(g)?(d(),l("div",te,[p("div",se,[p("form",{onSubmit:G(E,["prevent"]),class:"childFormContainer"},[(d(!0),l(H,null,J(u(S),(a,c)=>(d(),l("div",{key:c,class:"user-information-form__form-group d-flex flex-column"},[p("label",null,h(a.label)+" "+h(a.required?"*":""),1),a.type==="text"||a.type==="password"||a.type==="email"?K((d(),l("input",{key:0,type:a.type,"onUpdate:modelValue":B=>u(e)[a.vModel]=B,placeholder:a.placeholder,required:a.required,disabled:a.disabled},null,8,oe)),[[Q,u(e)[a.vModel]]]):m("",!0),a.required?(d(),l("div",ne,[_(a).show?(d(),l("span",{key:0,class:y(["text-danger",b])},h(_(a).message),3)):m("",!0)])):m("",!0)]))),128)),r.role!=="admin"&&r.formType==="create"?(d(),l("div",de,[W(o,{modelValue:u(e).departmentId,"onUpdate:modelValue":s[0]||(s[0]=a=>u(e).departmentId=a),allPlaceholder:"Select a department",required:"",disabledAll:!0,disabled:r.disabledSelector,customClass:"user-info"},null,8,["modelValue","disabled"]),_(C).show?(d(),l("span",{key:0,class:y(["text-danger",b])},h(_(C).message),3)):m("",!0)])):m("",!0),le],40,re)])])):(d(),X(n,{key:1}))],2)}}},fe=R(ie,[["__scopeId","data-v-55a9c115"]]);export{fe as _};
